<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/workspace.css">
    <title>workspace</title>
</head>
<body>
    <style>
        body {
            padding: 0%;
            margin: 0%;
        }

        .container {
            display: flex;
        }

        .menu {
            width: 400px;
        }

        .text {
            margin: 20px;
            padding: 10px;
            width: 80%;
            height: 30px;
            border-bottom-color: black;
            border: none;
            background-color: rgb(200, 203, 243);
            font-size: 20px;
            font-family: Helvetica;
            
        }

        .filename {
            margin: 20px;
            padding: 10px;
            width: 80%;
            height: 30px;
            border-bottom-color: black;
            border: none;
            background-color: rgb(200, 203, 243);
            font-size: 20px;
            font-family: Helvetica;
            color: black;
        }

        .search-bar {
            font-family: Helvetica;
            font-size: 30px;
            margin: 5px;
            margin-left: 10px;
            color:rgb(90, 27, 163);
            font-weight: bold;
        }
        input[type=text] {
            width: 200px;
            -webkit-transition: width 0.4s ease-in-out;
            transition: width 0.4s ease-in-out;
        }
        
        input[type=text]:focus {
            width: 50%;
        }

        .form {
            flex: 1;
        background: rgb(175, 178, 228)
        /* Just so it's visible */
        }

        textarea {
            width: 95%;
            /* height: 100%; */
            padding: 12px 20px;
            box-sizing: border-box;
            border: 2px solid #ccc;
            border-radius: 4px;
            background-color: #f8f8f8;
            font-size: 16px;
            resize: none;
            margin: 20px;
        }

        .save-btn {
            display: inline-block;

            background-color: #7b38d8;
            font-family: Helvetica;
            font-size: 15px;
            margin: 5px;
            padding: 10px;
            position: absolute;
            right: 10px;
            width: 80px;
            height: 50px;
            margin-top: 21px;
            border-radius: 15px;
            display: inline-block;
            border: 4px double #cccccc;
            color: #eeeeee;
            text-align: center;
            transition: all 0.5s;
            cursor: pointer;
        }
        button span {
            cursor: pointer;
            display: inline-block;
            position: relative;
            transition: 0.5s;
        }
        button span:after {
            content: '\00bb';
            position: absolute;
            opacity: 0;
            top: 0;
            left: -20px;
            transition: 0.5s;
        }
        button:hover {
            background-color: #cab7d6;
        }
        button:hover span {
            padding-left: 25px;
        }
        button:hover span:after {
            opacity: 1;
            right: 0;
        }
        .choose-btn {
            display: inline-block;

            background-color: #7b38d8;
            font-family: Helvetica;
            font-size: 15px;
            margin: 5px;
            padding: 10px;
            position: absolute;
            right: 100px;
            width: 200px;
            height: 20px;
            border-radius: 15px;
            display: inline-block;
            border: 4px double #cccccc;
            color: #eeeeee;
            text-align: center;
            transition: all 0.5s;
            cursor: pointer;
        }

        li {
            list-style-type: none; 
            margin: 10px;
            /* background-color: coral; */
            font-size: 18px;
            padding-left: 10px;
            color:rgb(36, 34, 178);
            background-color: rgb(200, 203, 243);
            ;
            /* flex: 1; */
        }
        .open-btn {
            background-color: #7b38d8;
            font-family: Helvetica;
            font-size: 15px;
            margin: 5px;
            border-radius: 15px;
            position: relative;
            margin: 10px;
            width: 60px;
            height: 30px;
            border: 4px double #cccccc;
            color: #eeeeee;
            text-align: center;
            transition: all 0.5s;
            left: 100px;
            /* flex: 1; */
        }

    </style>
    <div class="container">

        <div class="menu">
            <label for="" class="search-bar">Search</label>
            <input class="text" type="text" name="search_bar" placeholder="Search..">
            <% for(let i=0; i<files.length; i++) { %>
                <li>
                    <%= files[i].name %>
                    <a href="/workspace/<%= files[i].name %>">
                        <button class="open-btn" id="show">Show</button>
                    </a>
                </li>
            <% } %>
            
        </div>

        <form class="form">
            <button type="button" class="save-btn" style="float: right" id="workspace">Review</button>
            <div>
                <label for="input-file"></label><br>             
               <!-- for adding file name in filename text -->
             <input type="file" name="input-file" class="choose-btn" id="input-file" onchange="document.getElementById('filename').value = this.value.split('\\').pop().split('/').pop()">
            </div>
             <input type="text" name="filename" id="file-name" class="filename" placeholder="Insert a title">    
             <!-- <button class="save-btn" id="back-btn">Back</button> -->
            <textarea class="textarea" name="content" id="content-target" cols="80" rows="50"><%= content %></textarea>
            
        </form>
    </div>

</body>

<script>
    const inputfile = document.getElementById('input-file');
    inputfile.addEventListener('change', saveFile);

    function saveFile() {
    const filepath = document.getElementById('input-file').value;
    console.log(filepath);
        let filename = "";
        for(let i=filepath.length-1; i>=0; i--) {
            if(filepath[i] >= 'A' && filepath[i] <= 'Z') 
                filename = filepath[i] + filename;
            else if(filepath[i] >= 'a' && filepath[i] <= 'z' )
                filename = filepath[i] + filename;
            else if(filepath[i]==='.')
                filename = filepath[i] + filename;
            else break;
        }
        console.log(filename);
        var fr=new FileReader();
        fr.onload=function(){
            let filecontent =fr.result;

            async function saveFileAndContent() {
                var details = {
                    'filename': filename,
                    'filecontent': filecontent,
                };

                var formBody = [];
                for (var property in details) {
                    var encodedKey = encodeURIComponent(property);
                    var encodedValue = encodeURIComponent(details[property]);
                    formBody.push(encodedKey + "=" + encodedValue);
                }
                formBody = formBody.join("&");

                const option = {
                    method: "POST",
                    headers: {
                        "Content-Type": 'application/x-www-form-urlencoded;charset=UTF-8',
                    },
                    body: formBody
                }

                let result = await fetch("/api/saveFileAndContent", option).then((res) => res.json());
                // console.log(result);
            }
            saveFileAndContent();
            window.location.href = "/workspace";
        }
        
        fr.readAsText(this.files[0]);
    }
</script>
</html>